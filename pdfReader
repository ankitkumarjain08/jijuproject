import csv
import PyPDF2

# Path to the PDF file
pdf_path = "C:\\Users\\Admin\\Downloads\\wordpress-pdf-invoice-plugin-sample.pdf"


# Read PDF
def read_pdf(pdf_path):
    with open(pdf_path, 'rb') as file:
        reader = PyPDF2.PdfReader(file)
        text = ''
        for page in reader.pages:
            text += page.extract_text()
        return text


# Extract relevant data
def extract_data(pdf_text):
    from_address = ""
    to_address = ""
    invoice_number = ""
    order_number = ""
    invoice_date = ""
    due_date = ""
    total_due = ""

    lines = pdf_text.split('\n')

    for i, line in enumerate(lines):
        if line.startswith('From:'):
            from_address = ' '.join(lines[i + 1:i + 4])
        elif line.startswith('To:'):
            to_address = ' '.join(lines[i + 1:i + 4])
        elif 'Invoice Number' in line:
            invoice_number = line.split()[-1]
        elif 'Order Number' in line:
            order_number = line.split()[-1]
        elif 'Invoice Date' in line:
            invoice_date = ' '.join(line.split()[2:])
        elif 'Due Date' in line:
            due_date = ' '.join(line.split()[2:])
        elif 'Total Due' in line:
            total_due = line.split()[-1]

    return {
        'from_address': from_address,
        'to_address': to_address,
        'invoice_number': invoice_number,
        'order_number': order_number,
        'invoice_date': invoice_date,
        'due_date': due_date,
        'total_due': total_due
    }


# Write to CSV
def write_to_csv(data, output_file):
    with open(output_file, mode='w', newline='') as file:
        writer = csv.DictWriter(file, fieldnames=['From Address', 'To Address', 'Invoice Number', 'Order Number',
                                                  'Invoice Date', 'Due Date', 'Total Due'])
        writer.writeheader()
        writer.writerow({
            'From Address': data['from_address'],
            'To Address': data['to_address'],
            'Invoice Number': data['invoice_number'],
            'Order Number': data['order_number'],
            'Invoice Date': data['invoice_date'],
            'Due Date': data['due_date'],
            'Total Due': data['total_due']
        })


# Main function to execute
pdf_text = read_pdf(pdf_path)
extracted_data = extract_data(pdf_text)
output_csv_path = "C:\\Users\\Admin\\Downloads\\invoice_data.csv"
write_to_csv(extracted_data, output_csv_path)

print(f'Data successfully extracted and written to {output_csv_path}')



------------------------------------------------------------------------------------------------------------------------------------


import csv
import PyPDF4
import logging
import os

# Configure logging
logging.basicConfig(
    filename='pdf_extractor.log',
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s - %(message)s'
)

# Path to the PDF file
pdf_path = '/mnt/data/wordpress-pdf-invoice-plugin-sample.pdf'

# Read PDF using PyPDF4
def read_pdf(pdf_path):
    try:
        with open(pdf_path, 'rb') as file:
            reader = PyPDF4.PdfFileReader(file)
            text = ''
            for page_num in range(reader.numPages):
                page = reader.getPage(page_num)
                text += page.extract_text()
            logging.info(f'Successfully read PDF: {pdf_path}')
            return text
    except FileNotFoundError:
        logging.error(f'File not found: {pdf_path}')
        raise
    except Exception as e:
        logging.error(f'Error reading PDF file: {e}')
        raise

# Extract relevant data dynamically
def extract_data(pdf_text, fields_to_extract=None):
    try:
        # If no fields are provided, return the plain text of the PDF
        if fields_to_extract is None or len(fields_to_extract) == 0:
            logging.info('No fields passed, extracting plain text.')
            return {'plain_text': pdf_text}
        
        # Initialize dictionary with required fields
        data = {field: '' for field in fields_to_extract}
        
        # Split PDF text into lines
        lines = pdf_text.split('\n')

        # Extract specific fields if requested
        for i, line in enumerate(lines):
            if 'from_address' in fields_to_extract and line.startswith('From:'):
                data['from_address'] = ' '.join(lines[i+1:i+4])
            elif 'to_address' in fields_to_extract and line.startswith('To:'):
                data['to_address'] = ' '.join(lines[i+1:i+4])
            elif 'invoice_number' in fields_to_extract and 'Invoice Number' in line:
                data['invoice_number'] = line.split()[-1]
            elif 'order_number' in fields_to_extract and 'Order Number' in line:
                data['order_number'] = line.split()[-1]
            elif 'invoice_date' in fields_to_extract and 'Invoice Date' in line:
                data['invoice_date'] = ' '.join(line.split()[2:])
            elif 'due_date' in fields_to_extract and 'Due Date' in line:
                data['due_date'] = ' '.join(line.split()[2:])
            elif 'total_due' in fields_to_extract and 'Total Due' in line:
                data['total_due'] = line.split()[-1]
        
        logging.info(f'Successfully extracted fields: {fields_to_extract}')
        return data
    except Exception as e:
        logging.error(f'Error extracting data: {e}')
        raise

# Write to CSV dynamically
def write_to_csv(data, output_file):
    try:
        # If plain text is extracted, write a single column
        if 'plain_text' in data:
            with open(output_file, mode='w', newline='') as file:
                writer = csv.writer(file)
                writer.writerow(['Plain Text'])
                writer.writerow([data['plain_text']])
        else:
            # Otherwise, write specified fields to the CSV
            fieldnames = [key for key in data if data[key]]
            with open(output_file, mode='w', newline='') as file:
                writer = csv.DictWriter(file, fieldnames=fieldnames)
                writer.writeheader()
                writer.writerow(data)

        logging.info(f'Data successfully written to CSV: {output_file}')
    except PermissionError:
        logging.error(f'Permission denied: Unable to write to {output_file}')
        raise
    except Exception as e:
        logging.error(f'Error writing to CSV: {e}')
        raise

# Main function to execute
def main():
    try:
        # Check if the PDF file exists before proceeding
        if not os.path.exists(pdf_path):
            logging.error(f'The file {pdf_path} does not exist.')
            return
        
        # Read the PDF content
        pdf_text = read_pdf(pdf_path)

        # Example 1: No parameters passed, extract plain text
        fields_to_extract = []  # If no parameters are passed, leave this empty

        # Example 2: Pass specific fields to extract (Uncomment to use this)
        # fields_to_extract = ['from_address', 'to_address', 'invoice_number']

        # Extract data based on parameters
        extracted_data = extract_data(pdf_text, fields_to_extract)

        # Output file path
        output_csv_path = '/mnt/data/invoice_data_dynamic.csv'

        # Write extracted data to CSV
        write_to_csv(extracted_data, output_csv_path)

        logging.info(f'Process completed successfully. Data written to {output_csv_path}')
        print(f'Data successfully extracted and written to {output_csv_path}')

    except Exception as e:
        logging.error(f'Error in the main process: {e}')
        print(f"An error occurred: {e}")

# Run the main function
if __name__ == '__main__':
    main()

------------------------------------------------------------------------------------------------------------------------------------
import csv
import PyPDF2
import logging
import os

# Set up logging configuration
logging.basicConfig(filename='pdf_extractor.log',
                    level=logging.INFO,
                    format='%(asctime)s - %(levelname)s - %(message)s')

# Combine everything into one method
def extract_pdf_to_csv(pdf_path, output_csv_path, fields_to_extract=None):
    # Check if the PDF file exists
    if not os.path.exists(pdf_path):
        logging.error(f"File not found: {pdf_path}")
        raise FileNotFoundError(f"The file {pdf_path} does not exist.")

    try:
        # Step 1: Read the PDF
        with open(pdf_path, 'rb') as file:
            reader = PyPDF2.PdfReader(file)
            text = ''
            for page in reader.pages:
                text += page.extract_text()
            logging.info(f"Successfully read PDF file: {pdf_path}")

        # Step 2: Extract data based on fields_to_extract
        if fields_to_extract is None:
            # If no fields specified, return the entire text content
            extracted_data = {'text': text}
            logging.info("No specific fields provided. Extracting full PDF content.")
        else:
            # Extract specific fields from the PDF text
            extracted_data = {}
            lines = text.split('\n')

            # Variables to store extracted data
            from_address = ""
            to_address = ""
            invoice_number = ""
            order_number = ""
            invoice_date = ""
            due_date = ""
            total_due = ""

            # Loop through the text to find and extract the necessary fields
            for i, line in enumerate(lines):
                if 'from_address' in fields_to_extract and line.startswith('From:'):
                    from_address = ' '.join(lines[i + 1:i + 4])
                if 'to_address' in fields_to_extract and line.startswith('To:'):
                    to_address = ' '.join(lines[i + 1:i + 4])
                if 'invoice_number' in fields_to_extract and 'Invoice Number' in line:
                    invoice_number = line.split()[-1]
                if 'order_number' in fields_to_extract and 'Order Number' in line:
                    order_number = line.split()[-1]
                if 'invoice_date' in fields_to_extract and 'Invoice Date' in line:
                    invoice_date = ' '.join(line.split()[2:])
                if 'due_date' in fields_to_extract and 'Due Date' in line:
                    due_date = ' '.join(line.split()[2:])
                if 'total_due' in fields_to_extract and 'Total Due' in line:
                    total_due = line.split()[-1]

            # Store extracted fields in the dictionary
            if 'from_address' in fields_to_extract:
                extracted_data['from_address'] = from_address
            if 'to_address' in fields_to_extract:
                extracted_data['to_address'] = to_address
            if 'invoice_number' in fields_to_extract:
                extracted_data['invoice_number'] = invoice_number
            if 'order_number' in fields_to_extract:
                extracted_data['order_number'] = order_number
            if 'invoice_date' in fields_to_extract:
                extracted_data['invoice_date'] = invoice_date
            if 'due_date' in fields_to_extract:
                extracted_data['due_date'] = due_date
            if 'total_due' in fields_to_extract:
                extracted_data['total_due'] = total_due

            logging.info(f"Successfully extracted specific fields: {extracted_data}")

        # Step 3: Write extracted data to CSV
        with open(output_csv_path, mode='w', newline='') as file:
            if fields_to_extract is None:
                # Write full content to the CSV
                writer = csv.writer(file)
                writer.writerow(['Full PDF Content'])
                writer.writerow([extracted_data['text']])  # Write full text content
            else:
                # Write only the extracted fields
                writer = csv.DictWriter(file, fieldnames=fields_to_extract)
                writer.writeheader()
                writer.writerow({field: extracted_data.get(field, '') for field in fields_to_extract})

        logging.info(f"Data successfully written to CSV: {output_csv_path}")
        print(f"Data successfully extracted and written to {output_csv_path}")

    except Exception as e:
        logging.error(f"An error occurred: {str(e)}")
        print(f"An error occurred: {e}")
        raise

# Example usage:
# If fields_to_extract is None, it will extract the full PDF content.
pdf_path = "C:\\Users\\Admin\\Downloads\\wordpress-pdf-invoice-plugin-sample.pdf"
output_csv_path = "C:\\Users\\Admin\\Downloads\\full_pdf_content.csv"

# Example with no fields (extracts the full content)
extract_pdf_to_csv(pdf_path, output_csv_path, fields_to_extract=['from_address', 'to_address', 'invoice_number'])

# Example with specific fields (e.g., from_address, to_address)
# fields_to_extract = ['from_address', 'to_address']
# extract_pdf_to_csv(pdf_path, output_csv_path, fields_to_extract)
