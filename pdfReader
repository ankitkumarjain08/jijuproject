import csv
import PyPDF2

# Path to the PDF file
pdf_path = "C:\\Users\\Admin\\Downloads\\wordpress-pdf-invoice-plugin-sample.pdf"


# Read PDF
def read_pdf(pdf_path):
    with open(pdf_path, 'rb') as file:
        reader = PyPDF2.PdfReader(file)
        text = ''
        for page in reader.pages:
            text += page.extract_text()
        return text


# Extract relevant data
def extract_data(pdf_text):
    from_address = ""
    to_address = ""
    invoice_number = ""
    order_number = ""
    invoice_date = ""
    due_date = ""
    total_due = ""

    lines = pdf_text.split('\n')

    for i, line in enumerate(lines):
        if line.startswith('From:'):
            from_address = ' '.join(lines[i + 1:i + 4])
        elif line.startswith('To:'):
            to_address = ' '.join(lines[i + 1:i + 4])
        elif 'Invoice Number' in line:
            invoice_number = line.split()[-1]
        elif 'Order Number' in line:
            order_number = line.split()[-1]
        elif 'Invoice Date' in line:
            invoice_date = ' '.join(line.split()[2:])
        elif 'Due Date' in line:
            due_date = ' '.join(line.split()[2:])
        elif 'Total Due' in line:
            total_due = line.split()[-1]

    return {
        'from_address': from_address,
        'to_address': to_address,
        'invoice_number': invoice_number,
        'order_number': order_number,
        'invoice_date': invoice_date,
        'due_date': due_date,
        'total_due': total_due
    }


# Write to CSV
def write_to_csv(data, output_file):
    with open(output_file, mode='w', newline='') as file:
        writer = csv.DictWriter(file, fieldnames=['From Address', 'To Address', 'Invoice Number', 'Order Number',
                                                  'Invoice Date', 'Due Date', 'Total Due'])
        writer.writeheader()
        writer.writerow({
            'From Address': data['from_address'],
            'To Address': data['to_address'],
            'Invoice Number': data['invoice_number'],
            'Order Number': data['order_number'],
            'Invoice Date': data['invoice_date'],
            'Due Date': data['due_date'],
            'Total Due': data['total_due']
        })


# Main function to execute
pdf_text = read_pdf(pdf_path)
extracted_data = extract_data(pdf_text)
output_csv_path = "C:\\Users\\Admin\\Downloads\\invoice_data.csv"
write_to_csv(extracted_data, output_csv_path)

print(f'Data successfully extracted and written to {output_csv_path}')
